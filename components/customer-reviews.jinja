{% if reviews %}
    {% for review in reviews %}
            <div class="card card-review mt-2 mb-4 bg-transparent">
                    <div class="card-body">
                            <div class="d-flex">
                                    <span class="icon-account_circle">
                                        <span class="d-none">{{ review.customer.name }}</span>
                                    </span>
                                    <div class="card-name">
                                            <p class="card-name-customer">{{ review.customer.name }}</p>
                                            <div class="d-flex card-rate-comment">
                                                {% set rating=review.rating %}{% include 'components/rating-stars.jinja' %}
                                            </div>
                                    </div>
                                    <div class="card-date user-review-date" data-time-ago-date="{{ review.created_at }}">    
                                    </div>
                            </div>
                            <div class="card-paragraph text-justify mt-2 user-review-text">{{ review.comment | safe }}</div>
                            {% if review.images %}
                            <div class="d-flex review-images-container mt-3 ">
                                {% for image in review.images %}
                                        <img src="{{ image.path }}" attr-index={{ loop.index0 }} />
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if review.reply %}
                            <div class="review-reply-card mt-4">
                                <div class="d-flex align-items-center">
                                    <span class="icon-account_circle">
                                        <img src="{{ store.logo }}" />
                                    </span>
                                    <div class="card-name">
                                            <p class="card-name-customer">{{ store.name }}</p>
                                    </div>
                                </div>
                                <div class="card-paragraph text-justify mt-2 user-review-text">{{ review.reply.text | safe }}</div>
                                {% if review.reply.images %}
                                <div class="d-flex review-images-container mt-3 ">
                                        {% for image in review.reply.images %}
                                                <img src="{{ image.path }}" attr-index={{ loop.index0 }} />
                                        {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                    </div>
            </div>
    {% endfor %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show first letter of customer name in avatar
    document.querySelectorAll('.card-review .icon-account_circle').forEach(function(el) {
        var span = el.querySelector('span');
        if (span) {
            var name = span.textContent || '';
            span.textContent = name.substring(0, 1);
            span.classList.remove('d-none');
        }
    });

    // Review images click handler - open in lightbox
    document.addEventListener('click', function(e) {
        var img = e.target.closest('.card-review .review-images-container img');
        if (!img) return;

        var container = img.parentElement;
        var index = parseInt(img.getAttribute('attr-index')) || 0;
        var images = [];

        container.querySelectorAll('img').forEach(function(imgEl) {
            images.push(imgEl.getAttribute('src'));
        });

        if (typeof openPhotoSwiper === 'function') {
            openPhotoSwiper(images, index);
        }
    });
});
</script>
{% endif %}
